var pageId="815157038515764",appId="1480115835608916",controller={},model={},img=[];$(document).ready(function(){$.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:appId,xfbml:!0,version:"v2.1"}),model.loginCallback(),model.displayHeader(),model.getAlbums()})}),model.loginCallback=function(){FB.getLoginStatus(function(e){"connected"===e.status?(model.displayMe(),$("#fblogin").addClass("dropdown").hide(),$("#user").show()):($("#user").hide(),$("#fblogin").removeClass("dropdown").show()),$("#splash").delay(1500).fadeOut(2e3)})},model.displayHeader=function(){FB.api("/"+pageId,"get",function(e){e&&!e.error&&($("#bg").css("background-image",'url("'+e.cover.source+'")'),$("#title").text(e.name))})},model.displayMe=function(){FB.api("/me?fields=name","get",function(e){if(e&&!e.error){var o=e.name;FB.api("/me/picture?redirect=false&type=square","get",function(e){e&&!e.error&&$("#user").html('<figure><img src="'+e.data.url+'"><figcaption>'+o+"</figcaption></figure>")})}})},model.getAlbums=function(){FB.api("/"+pageId+"/albums",function(e){if(e&&!e.error)for(var o=e.data.length,i=0,n=0;n<e.data.length;n++)FB.api("/"+e.data[n].id+"/photos",function(e){for(var n=e.data,l=0;l<n.length;l++)for(var s=0;s<n[l].images.length;s++)if(320===n[l].images[s].height){var a=n[l].name;void 0===a&&(a="");var t=n[l].likes;t=void 0===t?0:n[l].likes.data.length,img.push({id:n[l].id,source:n[l].images[s].source,url:n[l].source,title:a,likes:t})}i++,i===o&&(controller.displayPhotos(img),controller.likeBtn(img))})})},model.askPermissionToLike=function(e,o){return function(i){console.log("likeBtn pressed"),FB.api("/me/permissions",function(i){for(var n=!1,l=0;l<i.data.length;l++)"publish_actions"===i.data[l].permission&&"granted"===i.data[l].status&&(console.log("User has required permissions"),model.like(e,o),n=!0);n||(console.log("User does not have required permissions"),console.log("Asking for additional permissions..."),FB.login(function(i){i.authResponse?(model.like(e,o),console.log("Got access token")):console.log("User canceled login or did not authorize the app.")},{scope:"publish_actions"}))})}},model.like=function(e,o){FB.api("/me?fields=id",function(i){var n=i.id;console.log("Grabbing user ID: "+n),FB.api(e+"/likes?fields=id",function(i){var l=!1;console.log("Checking if previously liked...");for(var s=0;s<i.data.length;s++)i.data[s].id===n&&(console.log("alert user"),alert("I know you like this photo, but unfortunately Facebook only allows you to like it once."),l=!0);l||(console.log("Liking..."),FB.api("/"+e+"/likes","POST",function(e){if(e.success===!0){console.log("Like was successful");var i=img[o].likes;i++,$("#"+o).next().text(i)}else console.log("An error occurred: "+e.error.message),console.log(e)}))})})};