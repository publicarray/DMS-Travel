function loginCallback(){FB.getLoginStatus(function(e){"connected"===e.status?($("#alertText").text("Connected"),$("#alertBody").hide(),$(".alert").delay(1500).fadeOut(2e3),$(".splash").fadeOut(2e3),displayPage(),displayMe(),getAlbums()):($(".alert").fadeIn(2e3),$(".splash").fadeIn(2e3),$("#alertText").text("Please Login"),$("#alertBody").show())})}function displayPage(){FB.api("/"+pageId,"get",function(e){e&&!e.error&&($(".bg").css("background-image",'url("'+e.cover.source+'")'),$("#title").text(e.name),$("#description").text(e.description))})}function displayMe(){FB.api("/me?fields=name","get",function(e){if(e&&!e.error){var i=e.name;FB.api("/me/picture?redirect=false&type=square","get",function(e){e&&!e.error&&$("#user").html('<figure><img src="'+e.data.url+'"><figcaption>'+i+"</figcaption></figure>")})}})}function getAlbums(){FB.api("/"+pageId+"/albums",function(e){if(e&&!e.error)for(var i=e.data.length,o=0,t=0;t<e.data.length;t++)FB.api("/"+e.data[t].id+"/photos",function(e){for(var t=e.data,a=0;a<t.length;a++)for(var n=0;n<t[a].images.length;n++)if(320===t[a].images[n].height){var s=t[a].name;void 0===s&&(s="");var l=t[a].likes;l=void 0===l?0:t[a].likes.data.length,img.push({id:t[a].id,source:t[a].images[n].source,url:t[a].source,title:s,likes:l})}o++,o===i&&(displayPhotos(img),likeBtn(img))})})}function displayPhotos(e){var i="";console.log(e);for(var o=0;o<e.length;o++)i+='<figure class="cell"><a href="'+e[o].url+'" data-lightbox="gallary" data-title="'+e[o].title+'"><img src="'+e[o].source+'" alt="'+e[o].title+'"></a><figcaption>'+e[o].title+'<br><img id="'+o+'" src="img/fbl.png" title="Like"><span>'+e[o].likes+"</span></figcaption></figure>";$(".gallery").html(i)}function likeBtn(e){for(var i=0;i<e.length;i++){var o=e[i].id;$("#"+i).click(askPermissionToLike(o,i))}}function askPermissionToLike(e,i){return function(o){console.log("likeBtn pressed"),FB.api("/me/permissions",function(o){for(var t=!1,a=0;a<o.data.length;a++)"publish_actions"===o.data[a].permission&&"granted"===o.data[a].status&&(console.log("User has required permissions"),like(e,i),t=!0);t||(console.log("User does not have required permissions"),console.log("Asking for additional permissions..."),FB.login(function(o){o.authResponse?(like(e,i),console.log("Got access token")):console.log("User canceled login or did not authorize the app.")},{scope:"publish_actions"}))})}}function like(e,i){FB.api("/me?fields=id",function(o){var t=o.id;console.log("Grabbing user ID: "+t),FB.api(e+"/likes?fields=id",function(o){var a=!1;console.log("Checking if previously liked...");for(var n=0;n<o.data.length;n++)o.data[n].id===t&&(console.log("alert user"),alert("I know you like this photo, but unfortunately Facebook only allows you to like it once."),a=!0);a||(console.log("Liking..."),FB.api("/"+e+"/likes","POST",function(e){if(e.success===!0){console.log("Like was successful");var o=img[i].likes;o++,$("#"+i).next().text(o)}else console.log("An error occurred: "+e.error.message),console.log(e)}))})})}var pageId="815157038515764",appId="1480115835608916",img=[];$(document).ready(function(){$.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:appId,xfbml:!0,version:"v2.1"}),loginCallback()})}),$("input").keypress(function(e){13===e.which&&search()});