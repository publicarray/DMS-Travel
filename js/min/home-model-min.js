var pageId="815157038515764",appId="1480115835608916",controller={},model={},img=[];$(document).ready(function(){$.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:appId,xfbml:!0,version:"v2.1"}),model.loginCallback(),model.displayHeader(),model.getAlbums()})}),model.loginCallback=function(){FB.getLoginStatus(function(e){"connected"===e.status?($("#alertText").text("Connected"),$("#alertBody").hide(),$("#alert").delay(1500).fadeOut(2e3),$("#splash").fadeOut(2e3),model.displayMe()):($("#alert").fadeIn(2e3),$("#splash").fadeIn(1e3),$("#alertText").text("Please Login"),$("#alertBody").show())})},model.displayHeader=function(){FB.api("/"+pageId,"get",function(e){e&&!e.error&&($("#bg").css("background-image",'url("'+e.cover.source+'")'),$("#title").text(e.name))})},model.displayMe=function(){FB.api("/me?fields=name","get",function(e){if(e&&!e.error){var o=e.name;FB.api("/me/picture?redirect=false&type=square","get",function(e){e&&!e.error&&$("#user").html('<figure><img src="'+e.data.url+'"><figcaption>'+o+"</figcaption></figure>")})}})},model.getAlbums=function(){FB.api("/"+pageId+"/albums",function(e){if(e&&!e.error)for(var o=e.data.length,i=0,a=0;a<e.data.length;a++)FB.api("/"+e.data[a].id+"/photos",function(e){for(var a=e.data,l=0;l<a.length;l++)for(var n=0;n<a[l].images.length;n++)if(320===a[l].images[n].height){var t=a[l].name;void 0===t&&(t="");var s=a[l].likes;s=void 0===s?0:a[l].likes.data.length,img.push({id:a[l].id,source:a[l].images[n].source,url:a[l].source,title:t,likes:s})}i++,i===o&&(controller.displayPhotos(img),controller.likeBtn(img))})})},model.askPermissionToLike=function(e,o){return function(i){console.log("likeBtn pressed"),FB.api("/me/permissions",function(i){for(var a=!1,l=0;l<i.data.length;l++)"publish_actions"===i.data[l].permission&&"granted"===i.data[l].status&&(console.log("User has required permissions"),model.like(e,o),a=!0);a||(console.log("User does not have required permissions"),console.log("Asking for additional permissions..."),FB.login(function(i){i.authResponse?(model.like(e,o),console.log("Got access token")):console.log("User canceled login or did not authorize the app.")},{scope:"publish_actions"}))})}},model.like=function(e,o){FB.api("/me?fields=id",function(i){var a=i.id;console.log("Grabbing user ID: "+a),FB.api(e+"/likes?fields=id",function(i){var l=!1;console.log("Checking if previously liked...");for(var n=0;n<i.data.length;n++)i.data[n].id===a&&(console.log("alert user"),alert("I know you like this photo, but unfortunately Facebook only allows you to like it once."),l=!0);l||(console.log("Liking..."),FB.api("/"+e+"/likes","POST",function(e){if(e.success===!0){console.log("Like was successful");var i=img[o].likes;i++,$("#"+o).next().text(i)}else console.log("An error occurred: "+e.error.message),console.log(e)}))})})};